/***************************************************************************

    addrmap.h

    Macros and helper functions for handling address map definitions.

****************************************************************************

    Copyright Aaron Giles
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

        * Redistributions of source code must retain the above copyright
          notice, this list of conditions and the following disclaimer.
        * Redistributions in binary form must reproduce the above copyright
          notice, this list of conditions and the following disclaimer in
          the documentation and/or other materials provided with the
          distribution.
        * Neither the name 'MAME' nor the names of its contributors may be
          used to endorse or promote products derived from this software
          without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY AARON GILES ''AS IS'' AND ANY EXPRESS OR
    IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
    WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
    DISCLAIMED. IN NO EVENT SHALL AARON GILES BE LIABLE FOR ANY DIRECT,
    INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
    (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
    SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
    HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
    STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
    IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
    POSSIBILITY OF SUCH DAMAGE.

***************************************************************************/

#pragma once

#ifndef __EMU_H__
#error Dont include this file directly; include emu.h instead.
#endif

#ifndef __ADDRMAP_H__
#define __ADDRMAP_H__



//**************************************************************************
//  CONSTANTS
//**************************************************************************

// address map handler types
enum map_handler_type
{
	AMH_NONE = 0,
	AMH_RAM,
	AMH_ROM,
	AMH_NOP,
	AMH_UNMAP,
	AMH_HANDLER,
	AMH_DEVICE_HANDLER,
	AMH_PORT,
	AMH_BANK
};



//**************************************************************************
//  TYPE DEFINITIONS
//**************************************************************************

// address map constructors are functions generated by tokens
typedef void (*address_map_constructor)(address_map &map, const device_config &devconfig);


// read_handler is a union of all the different read handler types
union read_handler
{
	genf *					generic;			// generic function pointer
	read8_space_func		shandler8;			// 8-bit space read handler
	read16_space_func		shandler16;			// 16-bit space read handler
	read32_space_func		shandler32;			// 32-bit space read handler
	read64_space_func		shandler64;			// 64-bit space read handler
	read8_device_func		dhandler8;			// 8-bit device read handler
	read16_device_func		dhandler16;			// 16-bit device read handler
	read32_device_func		dhandler32;			// 32-bit device read handler
	read64_device_func		dhandler64;			// 64-bit device read handler
};


// write_handler is a union of all the different write handler types
union write_handler
{
	genf *					generic;			// generic function pointer
	write8_space_func		shandler8;			// 8-bit space write handler
	write16_space_func		shandler16;			// 16-bit space write handler
	write32_space_func		shandler32;			// 32-bit space write handler
	write64_space_func		shandler64;			// 64-bit space write handler
	write8_device_func		dhandler8;			// 8-bit device write handler
	write16_device_func		dhandler16;			// 16-bit device write handler
	write32_device_func		dhandler32;			// 32-bit device write handler
	write64_device_func		dhandler64;			// 64-bit device write handler
};


// memory_handler is a union of all read and write handler types
union memory_handler
{
	genf *					generic;			// generic function pointer
	read_handler			read;				// read handler union
	write_handler			write;				// write handler union
};


// address map handler data
class map_handler_data
{
public:
	map_handler_data()
		: type(AMH_NONE),
		  bits(0),
		  mask(0),
		  name(NULL),
		  tag(NULL) { handler.generic = NULL; }

	map_handler_type		type;				// type of the handler
	UINT8					bits;				// width of the handler in bits, or 0 for default
	UINT8					mask;				// mask for which lanes apply
	memory_handler			handler;			// a memory handler
	const char *			name;				// name of the handler
	const char *			tag;				// tag pointing to a reference
	astring					derived_tag;		// string used to hold derived names
};



// ======================> address_map_entry

// address_map_entry is a linked list element describing one address range in a map
class address_map_entry
{
public:
	// construction/destruction
	address_map_entry(address_map &map, offs_t start, offs_t end);

	// simple inline setters	
	void set_mirror(offs_t _mirror) { m_addrmirror = _mirror; }
	void set_read_type(map_handler_type _type) { m_read.type = _type; }
	void set_write_type(map_handler_type _type) { m_write.type = _type; }
	void set_region(const char *tag, offs_t offset) { m_region = tag; m_rgnoffs = offset; }
	void set_share(const char *tag) { m_share = tag; }
	void set_sizeptr(size_t *_sizeptr) { m_sizeptr = _sizeptr; }
	void set_member_baseptr(FPTR offs) { m_baseptroffs_plus1 = offs + 1; }
	void set_member_sizeptr(FPTR offs) { m_sizeptroffs_plus1 = offs + 1; }
	void set_generic_baseptr(FPTR offs) { m_genbaseptroffs_plus1 = offs + 1; }
	void set_generic_sizeptr(FPTR offs) { m_gensizeptroffs_plus1 = offs + 1; }

	// mask setting
	void set_mask(offs_t _mask);

	// I/O port configuration	
	void set_read_port(const device_config &devconfig, const char *tag);
	void set_write_port(const device_config &devconfig, const char *tag);
	void set_readwrite_port(const device_config &devconfig, const char *tag);
	
	// memory bank configuration
	void set_read_bank(const device_config &devconfig, const char *tag);
	void set_write_bank(const device_config &devconfig, const char *tag);
	void set_readwrite_bank(const device_config &devconfig, const char *tag);

	// public state
	address_map_entry *	m_next;					// pointer to the next entry
	address_map &		m_map;					// reference to our owning map
	astring				m_region_string;		// string used to hold derived names

	offs_t				m_addrstart;			// start address
	offs_t				m_addrend;				// end address
	offs_t				m_addrmirror;			// mirror bits
	offs_t				m_addrmask;				// mask bits
	map_handler_data	m_read;					// data for read handler
	map_handler_data	m_write;				// data for write handler
	const char *		m_share;				// tag of a shared memory block
	void **				m_baseptr;				// receives pointer to memory (optional)
	size_t *			m_sizeptr;				// receives size of area in bytes (optional)
	UINT32				m_baseptroffs_plus1;	// offset of base pointer within driver_data, plus 1
	UINT32				m_sizeptroffs_plus1;	// offset of size pointer within driver_data, plus 1
	UINT32				m_genbaseptroffs_plus1;	// offset of base pointer within generic_pointers, plus 1
	UINT32				m_gensizeptroffs_plus1;	// offset of size pointer within generic_pointers, plus 1
	const char *		m_region;				// tag of region containing the memory backing this entry
	offs_t				m_rgnoffs;				// offset within the region

	void *				m_memory;				// pointer to memory backing this entry
	offs_t				m_bytestart;			// byte-adjusted start address
	offs_t				m_byteend;				// byte-adjusted end address
	offs_t				m_bytemirror;			// byte-adjusted mirror bits
	offs_t				m_bytemask;				// byte-adjusted mask bits

protected:
	// internal base pointer setting (derived classes provide typed versions)
	void internal_set_baseptr(void **_baseptr) { m_baseptr = _baseptr; }

	// internal handler setters for 8-bit functions
	void internal_set_handler(read8_space_func func, const char *string, UINT64 mask);
	void internal_set_handler(write8_space_func func, const char *string, UINT64 mask);
	void internal_set_handler(read8_space_func rfunc, const char *rstring,write8_space_func wfunc,  const char *wstring, UINT64 mask);
	void internal_set_handler(const device_config &devconfig, const char *tag, read8_device_func func, const char *string, UINT64 mask);
	void internal_set_handler(const device_config &devconfig, const char *tag, write8_device_func func, const char *string, UINT64 mask);
	void internal_set_handler(const device_config &devconfig, const char *tag, read8_device_func rfunc, const char *rstring, write8_device_func wfunc, const char *wstring, UINT64 mask);

	// internal handler setters for 16-bit functions
	void internal_set_handler(read16_space_func func, const char *string, UINT64 mask);
	void internal_set_handler(write16_space_func func, const char *string, UINT64 mask);
	void internal_set_handler(read16_space_func rfunc, const char *rstring, write16_space_func wfunc, const char *wstring, UINT64 mask);
	void internal_set_handler(const device_config &devconfig, const char *tag, read16_device_func func, const char *string, UINT64 mask);
	void internal_set_handler(const device_config &devconfig, const char *tag, write16_device_func func, const char *string, UINT64 mask);
	void internal_set_handler(const device_config &devconfig, const char *tag, read16_device_func rfunc, const char *rstring, write16_device_func wfunc, const char *wstring, UINT64 mask);

	// internal handler setters for 32-bit functions
	void internal_set_handler(read32_space_func func, const char *string, UINT64 mask);
	void internal_set_handler(write32_space_func func, const char *string, UINT64 mask);
	void internal_set_handler(read32_space_func rfunc, const char *rstring, write32_space_func wfunc, const char *wstring, UINT64 mask);
	void internal_set_handler(const device_config &devconfig, const char *tag, read32_device_func func, const char *string, UINT64 mask);
	void internal_set_handler(const device_config &devconfig, const char *tag, write32_device_func func, const char *string, UINT64 mask);
	void internal_set_handler(const device_config &devconfig, const char *tag, read32_device_func rfunc, const char *rstring, write32_device_func wfunc, const char *wstring, UINT64 mask);

	// internal handler setters for 64-bit functions
	void internal_set_handler(read64_space_func func, const char *string, UINT64 mask);
	void internal_set_handler(write64_space_func func, const char *string, UINT64 mask);
	void internal_set_handler(read64_space_func rfunc, const char *rstring, write64_space_func wfunc, const char *wstring, UINT64 mask);
	void internal_set_handler(const device_config &devconfig, const char *tag, read64_device_func func, const char *string, UINT64 mask);
	void internal_set_handler(const device_config &devconfig, const char *tag, write64_device_func func, const char *string, UINT64 mask);
	void internal_set_handler(const device_config &devconfig, const char *tag, read64_device_func rfunc, const char *rstring, write64_device_func wfunc, const char *wstring, UINT64 mask);

private:
	// helper functions
	bool unitmask_is_appropriate(UINT8 width, UINT64 unitmask, const char *string);
};


// ======================> address_map_entry8

// 8-bit address map version of address_map_entry which only permits valid 8-bit handlers
class address_map_entry8 : public address_map_entry
{
public:
	address_map_entry8(address_map &map, offs_t start, offs_t end);

	void set_baseptr(UINT8 **baseptr) { internal_set_baseptr(reinterpret_cast<void **>(baseptr)); }
	
	// native-size handlers
	void set_handler(read8_space_func func, const char *string) { internal_set_handler(func, string, 0); }
	void set_handler(write8_space_func func, const char *string) { internal_set_handler(func, string, 0); }
	void set_handler(read8_space_func rfunc, const char *rstring, write8_space_func wfunc, const char *wstring) { internal_set_handler(rfunc, rstring, wfunc, wstring, 0); }
	void set_handler(const device_config &devconfig, const char *tag, read8_device_func func, const char *string) { internal_set_handler(devconfig, tag, func, string, 0); }
	void set_handler(const device_config &devconfig, const char *tag, write8_device_func func, const char *string) { internal_set_handler(devconfig, tag, func, string, 0); }
	void set_handler(const device_config &devconfig, const char *tag, read8_device_func rfunc, const char *rstring, write8_device_func wfunc, const char *wstring) { internal_set_handler(devconfig, tag, rfunc, rstring, wfunc, wstring, 0); }
};


// ======================> address_map_entry16

// 16-bit address map version of address_map_entry which only permits valid 16-bit handlers
class address_map_entry16 : public address_map_entry
{
public:
	address_map_entry16(address_map &map, offs_t start, offs_t end);

	void set_baseptr(UINT16 **baseptr) { internal_set_baseptr(reinterpret_cast<void **>(baseptr)); }
	
	// native-size handlers
	void set_handler(read16_space_func func, const char *string) { internal_set_handler(func, string, 0); }
	void set_handler(write16_space_func func, const char *string) { internal_set_handler(func, string, 0); }
	void set_handler(read16_space_func rfunc, const char *rstring, write16_space_func wfunc, const char *wstring) { internal_set_handler(rfunc, rstring, wfunc, wstring, 0); }
	void set_handler(const device_config &devconfig, const char *tag, read16_device_func func, const char *string) { internal_set_handler(devconfig, tag, func, string, 0); }
	void set_handler(const device_config &devconfig, const char *tag, write16_device_func func, const char *string) { internal_set_handler(devconfig, tag, func, string, 0); }
	void set_handler(const device_config &devconfig, const char *tag, read16_device_func rfunc, const char *rstring, write16_device_func wfunc, const char *wstring) { internal_set_handler(devconfig, tag, rfunc, rstring, wfunc, wstring, 0); }

	// 8-bit handlers
	void set_handler(read8_space_func func, const char *string, UINT16 mask) { internal_set_handler(func, string, mask); }
	void set_handler(write8_space_func func, const char *string, UINT16 mask) { internal_set_handler(func, string, mask); }
	void set_handler(read8_space_func rfunc, const char *rstring, write8_space_func wfunc, const char *wstring, UINT16 mask) { internal_set_handler(rfunc, rstring, wfunc, wstring, mask); }
	void set_handler(const device_config &devconfig, const char *tag, read8_device_func func, const char *string, UINT16 mask) { internal_set_handler(devconfig, tag, func, string, mask); }
	void set_handler(const device_config &devconfig, const char *tag, write8_device_func func, const char *string, UINT16 mask) { internal_set_handler(devconfig, tag, func, string, mask); }
	void set_handler(const device_config &devconfig, const char *tag, read8_device_func rfunc, const char *rstring, write8_device_func wfunc, const char *wstring, UINT16 mask) { internal_set_handler(devconfig, tag, rfunc, rstring, wfunc, wstring, mask); }
};


// ======================> address_map_entry32

// 32-bit address map version of address_map_entry which only permits valid 32-bit handlers
class address_map_entry32 : public address_map_entry
{
public:
	address_map_entry32(address_map &map, offs_t start, offs_t end);

	void set_baseptr(UINT32 **baseptr) { internal_set_baseptr(reinterpret_cast<void **>(baseptr)); }
	
	// native-size handlers
	void set_handler(read32_space_func func, const char *string) { internal_set_handler(func, string, 0); }
	void set_handler(write32_space_func func, const char *string) { internal_set_handler(func, string, 0); }
	void set_handler(read32_space_func rfunc, const char *rstring, write32_space_func wfunc, const char *wstring) { internal_set_handler(rfunc, rstring, wfunc, wstring, 0); }
	void set_handler(const device_config &devconfig, const char *tag, read32_device_func func, const char *string) { internal_set_handler(devconfig, tag, func, string, 0); }
	void set_handler(const device_config &devconfig, const char *tag, write32_device_func func, const char *string) { internal_set_handler(devconfig, tag, func, string, 0); }
	void set_handler(const device_config &devconfig, const char *tag, read32_device_func rfunc, const char *rstring, write32_device_func wfunc, const char *wstring) { internal_set_handler(devconfig, tag, rfunc, rstring, wfunc, wstring, 0); }

	// 16-bit handlers
	void set_handler(read16_space_func func, const char *string, UINT32 mask) { internal_set_handler(func, string, mask); }
	void set_handler(write16_space_func func, const char *string, UINT32 mask) { internal_set_handler(func, string, mask); }
	void set_handler(read16_space_func rfunc, const char *rstring, write16_space_func wfunc, const char *wstring, UINT32 mask) { internal_set_handler(rfunc, rstring, wfunc, wstring, mask); }
	void set_handler(const device_config &devconfig, const char *tag, read16_device_func func, const char *string, UINT32 mask) { internal_set_handler(devconfig, tag, func, string, mask); }
	void set_handler(const device_config &devconfig, const char *tag, write16_device_func func, const char *string, UINT32 mask) { internal_set_handler(devconfig, tag, func, string, mask); }
	void set_handler(const device_config &devconfig, const char *tag, read16_device_func rfunc, const char *rstring, write16_device_func wfunc, const char *wstring, UINT32 mask) { internal_set_handler(devconfig, tag, rfunc, rstring, wfunc, wstring, mask); }

	// 8-bit handlers
	void set_handler(read8_space_func func, const char *string, UINT32 mask) { internal_set_handler(func, string, mask); }
	void set_handler(write8_space_func func, const char *string, UINT32 mask) { internal_set_handler(func, string, mask); }
	void set_handler(read8_space_func rfunc, const char *rstring, write8_space_func wfunc, const char *wstring, UINT32 mask) { internal_set_handler(rfunc, rstring, wfunc, wstring, mask); }
	void set_handler(const device_config &devconfig, const char *tag, read8_device_func func, const char *string, UINT32 mask) { internal_set_handler(devconfig, tag, func, string, mask); }
	void set_handler(const device_config &devconfig, const char *tag, write8_device_func func, const char *string, UINT32 mask) { internal_set_handler(devconfig, tag, func, string, mask); }
	void set_handler(const device_config &devconfig, const char *tag, read8_device_func rfunc, const char *rstring, write8_device_func wfunc, const char *wstring, UINT32 mask) { internal_set_handler(devconfig, tag, rfunc, rstring, wfunc, wstring, mask); }
};


// ======================> address_map_entry64

// 64-bit address map version of address_map_entry which only permits valid 64-bit handlers
class address_map_entry64 : public address_map_entry
{
public:
	address_map_entry64(address_map &map, offs_t start, offs_t end);

	void set_baseptr(UINT64 **baseptr) { internal_set_baseptr(reinterpret_cast<void **>(baseptr)); }
	
	// native-size handlers
	void set_handler(read64_space_func func, const char *string) { internal_set_handler(func, string, 0); }
	void set_handler(write64_space_func func, const char *string) { internal_set_handler(func, string, 0); }
	void set_handler(read64_space_func rfunc, const char *rstring, write64_space_func wfunc, const char *wstring) { internal_set_handler(rfunc, rstring, wfunc, wstring, 0); }
	void set_handler(const device_config &devconfig, const char *tag, read64_device_func func, const char *string) { internal_set_handler(devconfig, tag, func, string, 0); }
	void set_handler(const device_config &devconfig, const char *tag, write64_device_func func, const char *string) { internal_set_handler(devconfig, tag, func, string, 0); }
	void set_handler(const device_config &devconfig, const char *tag, read64_device_func rfunc, const char *rstring, write64_device_func wfunc, const char *wstring) { internal_set_handler(devconfig, tag, rfunc, rstring, wfunc, wstring, 0); }

	// 32-bit handlers
	void set_handler(read32_space_func func, const char *string, UINT64 mask) { internal_set_handler(func, string, mask); }
	void set_handler(write32_space_func func, const char *string, UINT64 mask) { internal_set_handler(func, string, mask); }
	void set_handler(read32_space_func rfunc, const char *rstring, write32_space_func wfunc, const char *wstring, UINT64 mask) { internal_set_handler(rfunc, rstring, wfunc, wstring, mask); }
	void set_handler(const device_config &devconfig, const char *tag, read32_device_func func, const char *string, UINT64 mask) { internal_set_handler(devconfig, tag, func, string, mask); }
	void set_handler(const device_config &devconfig, const char *tag, write32_device_func func, const char *string, UINT64 mask) { internal_set_handler(devconfig, tag, func, string, mask); }
	void set_handler(const device_config &devconfig, const char *tag, read32_device_func rfunc, const char *rstring, write32_device_func wfunc, const char *wstring, UINT64 mask) { internal_set_handler(devconfig, tag, rfunc, rstring, wfunc, wstring, mask); }

	// 16-bit handlers
	void set_handler(read16_space_func func, const char *string, UINT64 mask) { internal_set_handler(func, string, mask); }
	void set_handler(write16_space_func func, const char *string, UINT64 mask) { internal_set_handler(func, string, mask); }
	void set_handler(read16_space_func rfunc, const char *rstring, write16_space_func wfunc, const char *wstring, UINT64 mask) { internal_set_handler(rfunc, rstring, wfunc, wstring, mask); }
	void set_handler(const device_config &devconfig, const char *tag, read16_device_func func, const char *string, UINT64 mask) { internal_set_handler(devconfig, tag, func, string, mask); }
	void set_handler(const device_config &devconfig, const char *tag, write16_device_func func, const char *string, UINT64 mask) { internal_set_handler(devconfig, tag, func, string, mask); }
	void set_handler(const device_config &devconfig, const char *tag, read16_device_func rfunc, const char *rstring, write16_device_func wfunc, const char *wstring, UINT64 mask) { internal_set_handler(devconfig, tag, rfunc, rstring, wfunc, wstring, mask); }

	// 8-bit handlers
	void set_handler(read8_space_func func, const char *string, UINT64 mask) { internal_set_handler(func, string, mask); }
	void set_handler(write8_space_func func, const char *string, UINT64 mask) { internal_set_handler(func, string, mask); }
	void set_handler(read8_space_func rfunc, const char *rstring, write8_space_func wfunc, const char *wstring, UINT64 mask) { internal_set_handler(rfunc, rstring, wfunc, wstring, mask); }
	void set_handler(const device_config &devconfig, const char *tag, read8_device_func func, const char *string, UINT64 mask) { internal_set_handler(devconfig, tag, func, string, mask); }
	void set_handler(const device_config &devconfig, const char *tag, write8_device_func func, const char *string, UINT64 mask) { internal_set_handler(devconfig, tag, func, string, mask); }
	void set_handler(const device_config &devconfig, const char *tag, read8_device_func rfunc, const char *rstring, write8_device_func wfunc, const char *wstring, UINT64 mask) { internal_set_handler(devconfig, tag, rfunc, rstring, wfunc, wstring, mask); }
};


// ======================> address_map

// address_map holds global map parameters plus the head of the list of entries
class address_map
{
public:
	// construction/destruction
	address_map(const device_config &devconfig, int spacenum);
	~address_map();
	
	// configuration
	void configure(UINT8 _spacenum, UINT8 _databits);

	// setters
	void set_global_mask(offs_t mask);
	void set_unmap_value(UINT8 value) { m_unmapval = value; }

	// add a new entry of the given type
	address_map_entry8 *add(offs_t start, offs_t end, address_map_entry8 *ptr);
	address_map_entry16 *add(offs_t start, offs_t end, address_map_entry16 *ptr);
	address_map_entry32 *add(offs_t start, offs_t end, address_map_entry32 *ptr);
	address_map_entry64 *add(offs_t start, offs_t end, address_map_entry64 *ptr);

	// public data
	UINT8					m_spacenum;			// space number of the map
	UINT8					m_databits;			// data bits represented by the map
	UINT8					m_unmapval;			// unmapped memory value
	offs_t					m_globalmask;		// global mask
	address_map_entry *		m_entrylist;		// list of entries

private:
	// internal data
	address_map_entry **	m_tailptr;
};



//**************************************************************************
//  ADDRESS MAP MACROS
//**************************************************************************

// so that "0" can be used for unneeded address maps
#define construct_address_map_0 NULL


// start/end tags for the address map
#define ADDRESS_MAP_NAME(_name) construct_address_map_##_name

#define ADDRESS_MAP_START(_name, _space, _bits) \
void ADDRESS_MAP_NAME(_name)(address_map &map, const device_config &devconfig) \
{ \
	address_map_entry##_bits *curentry = NULL; \
	(void)curentry; \
	map.configure(_space, _bits); \

#define ADDRESS_MAP_END \
}

// use this to declare external references to an address map
#define ADDRESS_MAP_EXTERN(_name, _bits) \
	extern void ADDRESS_MAP_NAME(_name)(address_map &map, const device_config &devconfig)


// global controls
#define ADDRESS_MAP_GLOBAL_MASK(_mask) \
	map.set_global_mask(_mask); \

#define ADDRESS_MAP_UNMAP_LOW \
	map.set_unmap_value(0); \

#define ADDRESS_MAP_UNMAP_HIGH \
	map.set_unmap_value(~0); \


// importing data from other address maps
#define AM_IMPORT_FROM(_name) \
	ADDRESS_MAP_NAME(_name)(map, devconfig); \


// address ranges
#define AM_RANGE(_start, _end) \
	curentry = map.add(_start, _end, curentry); \

#define AM_MASK(_mask) \
	curentry->set_mask(_mask); \

#define AM_MIRROR(_mirror) \
	curentry->set_mirror(_mirror); \


// space reads
#define AM_READ(_handler) \
	curentry->set_handler(_handler, #_handler); \

#define AM_READ8(_handler, _unitmask) \
	curentry->set_handler(_handler, #_handler, _unitmask); \

#define AM_READ16(_handler, _unitmask) \
	curentry->set_handler(_handler, #_handler, _unitmask); \

#define AM_READ32(_handler, _unitmask) \
	curentry->set_handler(_handler, #_handler, _unitmask); \


// space writes
#define AM_WRITE(_handler) \
	curentry->set_handler(_handler, #_handler); \

#define AM_WRITE8(_handler, _unitmask) \
	curentry->set_handler(_handler, #_handler, _unitmask); \

#define AM_WRITE16(_handler, _unitmask) \
	curentry->set_handler(_handler, #_handler, _unitmask); \

#define AM_WRITE32(_handler, _unitmask) \
	curentry->set_handler(_handler, #_handler, _unitmask); \


// space reads/writes
#define AM_READWRITE(_rhandler, _whandler) \
	curentry->set_handler(_rhandler, #_rhandler, _whandler, #_whandler); \

#define AM_READWRITE8(_rhandler, _whandler, _unitmask) \
	curentry->set_handler(_rhandler, #_rhandler, _whandler, #_whandler, _unitmask); \

#define AM_READWRITE16(_rhandler, _whandler, _unitmask) \
	curentry->set_handler(_rhandler, #_rhandler, _whandler, #_whandler, _unitmask); \

#define AM_READWRITE32(_rhandler, _whandler, _unitmask) \
	curentry->set_handler(_rhandler, #_rhandler, _whandler, #_whandler, _unitmask); \


// device reads
#define AM_DEVREAD(_tag, _handler) \
	curentry->set_handler(devconfig, _tag, _handler, #_handler); \

#define AM_DEVREAD8(_tag, _handler, _unitmask) \
	curentry->set_handler(devconfig, _tag, _handler, #_handler, _unitmask); \

#define AM_DEVREAD16(_tag, _handler, _unitmask) \
	curentry->set_handler(devconfig, _tag, _handler, #_handler, _unitmask); \

#define AM_DEVREAD32(_tag, _handler, _unitmask) \
	curentry->set_handler(devconfig, _tag, _handler, #_handler, _unitmask); \


// device writes
#define AM_DEVWRITE(_tag, _handler) \
	curentry->set_handler(devconfig, _tag, _handler, #_handler); \

#define AM_DEVWRITE8(_tag, _handler, _unitmask) \
	curentry->set_handler(devconfig, _tag, _handler, #_handler, _unitmask); \

#define AM_DEVWRITE16(_tag, _handler, _unitmask) \
	curentry->set_handler(devconfig, _tag, _handler, #_handler, _unitmask); \

#define AM_DEVWRITE32(_tag, _handler, _unitmask) \
	curentry->set_handler(devconfig, _tag, _handler, #_handler, _unitmask); \


// device reads/writes
#define AM_DEVREADWRITE(_tag, _rhandler, _whandler) \
	curentry->set_handler(devconfig, _tag, _rhandler, #_rhandler, _whandler, #_whandler); \

#define AM_DEVREADWRITE8(_tag, _rhandler, _whandler, _unitmask) \
	curentry->set_handler(devconfig, _tag, _rhandler, #_rhandler, _whandler, #_whandler, _unitmask); \

#define AM_DEVREADWRITE16(_tag, _rhandler, _whandler, _unitmask) \
	curentry->set_handler(devconfig, _tag, _rhandler, #_rhandler, _whandler, #_whandler, _unitmask); \

#define AM_DEVREADWRITE32(_tag, _rhandler, _whandler, _unitmask) \
	curentry->set_handler(devconfig, _tag, _rhandler, #_rhandler, _whandler, #_whandler, _unitmask); \


// special-case accesses
#define AM_ROM \
	curentry->set_read_type(AMH_ROM); \

#define AM_RAM \
	curentry->set_read_type(AMH_RAM); \
	curentry->set_write_type(AMH_RAM); \

#define AM_READONLY \
	curentry->set_read_type(AMH_RAM); \

#define AM_WRITEONLY \
	curentry->set_write_type(AMH_RAM); \

#define AM_UNMAP \
	curentry->set_read_type(AMH_UNMAP); \
	curentry->set_write_type(AMH_UNMAP); \

#define AM_NOP \
	curentry->set_read_type(AMH_NOP); \
	curentry->set_write_type(AMH_NOP); \

#define AM_READNOP \
	curentry->set_read_type(AMH_NOP); \

#define AM_WRITENOP \
	curentry->set_write_type(AMH_NOP); \


// port accesses
#define AM_READ_PORT(_tag) \
	curentry->set_read_port(devconfig, _tag); \

#define AM_WRITE_PORT(_tag) \
	curentry->set_write_port(devconfig, _tag); \

#define AM_READWRITE_PORT(_tag) \
	curentry->set_readwrite_port(devconfig, _tag); \


// bank accesses
#define AM_READ_BANK(_tag) \
	curentry->set_read_bank(devconfig, _tag); \

#define AM_WRITE_BANK(_tag) \
	curentry->set_write_bank(devconfig, _tag); \

#define AM_READWRITE_BANK(_tag) \
	curentry->set_readwrite_bank(devconfig, _tag); \


// attributes for accesses
#define AM_REGION(_tag, _offs) \
	curentry->set_region(_tag, _offs); \

#define AM_SHARE(_tag) \
	curentry->set_share(_tag); \

#define AM_BASE(_base) \
	curentry->set_baseptr(_base); \

#define myoffsetof(_struct, _member)  ((FPTR)&((_struct *)0x1000)->_member - 0x1000)
#define AM_BASE_MEMBER(_struct, _member) \
	curentry->set_member_baseptr(myoffsetof(_struct, _member)); \

#define AM_BASE_GENERIC(_member) \
	curentry->set_generic_baseptr(myoffsetof(generic_pointers, _member)); \

#define AM_SIZE(_size) \
	curentry->set_sizeptr(_size); \

#define AM_SIZE_MEMBER(_struct, _member) \
	curentry->set_member_sizeptr(myoffsetof(_struct, _member)); \

#define AM_SIZE_GENERIC(_member) \
	curentry->set_generic_sizeptr(myoffsetof(generic_pointers, _member##_size)); \


// common shortcuts
#define AM_ROMBANK(_bank)					AM_READ_BANK(_bank)
#define AM_RAMBANK(_bank)					AM_READWRITE_BANK(_bank)
#define AM_RAM_READ(_read)					AM_READ(_read) AM_WRITEONLY
#define AM_RAM_WRITE(_write)				AM_READONLY AM_WRITE(_write)
#define AM_RAM_DEVREAD(_tag, _read)			AM_DEVREAD(_tag, _read) AM_WRITEONLY
#define AM_RAM_DEVWRITE(_tag, _write)		AM_READONLY AM_DEVWRITE(_tag, _write)

#define AM_BASE_SIZE_MEMBER(_struct, _base, _size)	AM_BASE_MEMBER(_struct, _base) AM_SIZE_MEMBER(_struct, _size)
#define AM_BASE_SIZE_GENERIC(_member)		AM_BASE_GENERIC(_member) AM_SIZE_GENERIC(_member)


#endif	/* __ADDRMAP_H__ */
